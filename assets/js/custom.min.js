"use strict";var stations,sensors,quality,select=document.querySelector(".select"),stationName=document.querySelector(".data__name"),sensorsDOM=document.querySelector(".data__sensors"),sensorData=[],createSelect=function(e){e.sort(function(e,t){return e.city.name.localeCompare(t.city.name)}),e.forEach(function(e){var t=document.createElement("option");t.text=e.city.name,null!=e.addressStreet&&(t.text+=" "+e.addressStreet),t.value=e.id,select.add(t)})},loadSelectValue=function(){null!=localStorage.getItem("station")?select.value=localStorage.getItem("station"):select.value=129,localStorage.setItem("station",select.value)},loadSensorData=function(e){var t=new FormData;t.append("url","http://api.gios.gov.pl/pjp-api/rest/data/getData/"+e),fetch("inc/ajax.php",{method:"POST",body:t}).then(function(e){return e.text()}).then(function(e){var t=JSON.parse(e);sensorData.push(t);for(var n="brak danych",a=0;a<t.values.length;a++)if(null!=t.values[a].value){n=t.values[a].value;break}sensorsDOM.innerHTML+='\n            <p class="data__sensor">\n                <span>'.concat(t.key,": </span>\n                <span>").concat(n,"</span>\n            </p>\n            ")}).catch(function(e){return console.log(e)})},loadSensors=function(){var e=new FormData;e.append("url","http://api.gios.gov.pl/pjp-api/rest/station/sensors/"+select.value),fetch("inc/ajax.php",{method:"POST",body:e}).then(function(e){return e.text()}).then(function(e){(sensors=JSON.parse(e)).forEach(function(e){loadSensorData(e.id)})}).catch(function(e){return console.log(e)})},loadQuality=function(){var e=new FormData;e.append("url","http://api.gios.gov.pl/pjp-api/rest/aqindex/getIndex/"+select.value),fetch("inc/ajax.php",{method:"POST",body:e}).then(function(e){return e.text()}).then(function(e){quality=JSON.parse(e),document.querySelector(".js-date").innerText=quality.stCalcDate,document.querySelector(".js-quality").innerText=quality.stIndexLevel.indexLevelName}).catch(function(e){return console.log(e)})},loadStacions=function(){var e=new FormData;e.append("url","http://api.gios.gov.pl/pjp-api/rest/station/findAll"),fetch("inc/ajax.php",{method:"POST",body:e}).then(function(e){return e.text()}).then(function(e){stations=JSON.parse(e),createSelect(stations),loadSelectValue(),loadSensors(),loadQuality()}).catch(function(e){return console.log(e)})};loadStacions(),select.addEventListener("change",function(){localStorage.setItem("station",select.value),sensorsDOM.innerHTML=null,loadSensors(),loadQuality()});