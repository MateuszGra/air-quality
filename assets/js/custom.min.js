"use strict";var stations,sensors,quality,select=document.querySelector(".select"),stationName=document.querySelector(".data__name"),htmlText="",dataWrapper=document.querySelector(".data"),counter=0,createSelect=function(t){t.sort(function(t,e){return t.city.name.localeCompare(e.city.name)}),t.forEach(function(t){var e=document.createElement("option");e.text=t.city.name,null!=t.addressStreet&&(e.text+=" "+t.addressStreet),e.value=t.id,select.add(e)})},loadSelectValue=function(){null!=localStorage.getItem("station")?select.value=localStorage.getItem("station"):select.value=129,localStorage.setItem("station",select.value)},loadSensorData=function(t,o){var e=new FormData;e.append("url","http://api.gios.gov.pl/pjp-api/rest/data/getData/"+t),fetch("inc/ajax.php",{method:"POST",body:e}).then(function(t){return t.text()}).then(function(t){for(var e=JSON.parse(t),a="brak danych",n=0;n<e.values.length;n++)if(null!=e.values[n].value){a=e.values[n].value;break}htmlText+='\n            <p class="data__sensor">\n                <span data-id="'.concat(sensors[o].param.idParam,'">').concat(sensors[o].param.paramName,": </span>\n                <span>").concat(a,"</span>\n            </p>\n            "),++counter==sensors.length&&(dataWrapper.innerHTML=htmlText)}).catch(function(t){return console.log(t)})},loadSensors=function(){var t=new FormData;t.append("url","http://api.gios.gov.pl/pjp-api/rest/station/sensors/"+select.value),fetch("inc/ajax.php",{method:"POST",body:t}).then(function(t){return t.text()}).then(function(t){sensors=JSON.parse(t),htmlText+="<p>Sensory:</p>",sensors.forEach(function(t,e){loadSensorData(t.id,e)})}).catch(function(t){return console.log(t)})},loadQuality=function(){dataWrapper.innerHTML='<div class="loader"></div>';var t=new FormData;t.append("url","http://api.gios.gov.pl/pjp-api/rest/aqindex/getIndex/"+select.value),fetch("inc/ajax.php",{method:"POST",body:t}).then(function(t){return t.text()}).then(function(t){quality=JSON.parse(t),htmlText+='\n            <p class="data__date">\n                <span>Data pomiaru: </span>\n                <span>'.concat(quality.stCalcDate,'</span>\n            </p>\n            <p class="data__quality">\n                <span>Index jako≈õci powietrza: </span>\n                <span class="js-quality">').concat(quality.stIndexLevel.indexLevelName,"</span>\n            </p>\n            "),loadSensors()}).catch(function(t){return console.log(t)})},loadStacions=function(){var t=new FormData;t.append("url","http://api.gios.gov.pl/pjp-api/rest/station/findAll"),fetch("inc/ajax.php",{method:"POST",body:t}).then(function(t){return t.text()}).then(function(t){stations=JSON.parse(t),createSelect(stations),loadSelectValue(),loadQuality()}).catch(function(t){return console.log(t)})};loadStacions(),select.addEventListener("change",function(){localStorage.setItem("station",select.value),htmlText="",counter=0,loadQuality()});