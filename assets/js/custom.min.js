"use strict";var stations,sensors,quality,select=document.querySelector(".search__select"),stationName=document.querySelector(".data__name"),htmlText="",dataWrapper=document.querySelector(".data"),counter=0,createSelect=function(e){e.sort(function(e,a){return e.city.name.localeCompare(a.city.name)}),e.forEach(function(e){var a=document.createElement("option");a.text=e.city.name,null!=e.addressStreet&&(a.text+=" "+e.addressStreet),a.value=e.id,select.add(a)})},loadSelectValue=function(){null!=localStorage.getItem("station")?select.value=localStorage.getItem("station"):select.value=129,localStorage.setItem("station",select.value)},loadSensorData=function(e,r){var a=new FormData;a.append("url","http://api.gios.gov.pl/pjp-api/rest/data/getData/"+e),fetch("inc/ajax.php",{method:"POST",body:a}).then(function(e){return e.text()}).then(function(e){for(var a,t=JSON.parse(e),n="brak danych",o=0;o<t.values.length;o++)if(null!=t.values[o].value){n=t.values[o].value;break}switch(sensors[r].param.idParam){case 1:a=350;break;case 3:a=50;break;case 5:a=120;break;case 6:a=200;break;case 8:a=1e4;break;case 10:a=5;break;case 69:a=25}var s=Math.round(n/a*100),c="";c=s<40?"bg-good":s<80?"bg-neutral":"bg-bad","brak danych"!=n&&(htmlText+='\n            <div class="sensor">\n                <p>\n                    <span class="sensor__label" data-id="'.concat(sensors[r].param.idParam,'">').concat(sensors[r].param.paramName,": </span>\n                    <span>").concat(n,' µg/m3</span>\n                </p>\n                <div class="sensor__row">\n                    <div class="sensor__bar">\n                        <div class="sensor__indicator ').concat(c,'" style="width: ').concat(s,'%"></div>\n                    </div>\n\n                    <span class="sensor__percent ').concat(c,'" >').concat(s,"%</span>\n                </div>\n            </div>\n            ")),++counter==sensors.length&&(htmlText+="</div>",dataWrapper.innerHTML=htmlText)}).catch(function(e){return console.log(e)})},loadSensors=function(){var e=new FormData;e.append("url","http://api.gios.gov.pl/pjp-api/rest/station/sensors/"+select.value),fetch("inc/ajax.php",{method:"POST",body:e}).then(function(e){return e.text()}).then(function(e){sensors=JSON.parse(e),htmlText+='<div class="box box--right">',sensors.forEach(function(e,a){loadSensorData(e.id,a)})}).catch(function(e){return console.log(e)})},loadQuality=function(){dataWrapper.innerHTML='<div class="loader"></div>';var e=new FormData;e.append("url","http://api.gios.gov.pl/pjp-api/rest/aqindex/getIndex/"+select.value),fetch("inc/ajax.php",{method:"POST",body:e}).then(function(e){return e.text()}).then(function(e){var a="";switch((quality=JSON.parse(e)).stIndexLevel.indexLevelName){case"Bardzo dobry":case"Dobry":a="font-good";break;case"Umiarkowany":case"Dostateczny":a="font-neutral";break;case"Zły":case"Bardzo zły":a="font-bad"}htmlText+='\n            <div class="box box--left">\n                <p>\n                    <span>Index jakości powietrza:</span>\n                    <span class="quality '.concat(a,'">').concat(quality.stIndexLevel.indexLevelName,'</span>\n                </p>\n                <p>\n                    <span>Data pomiaru:</span>\n                    <span class="date">').concat(quality.stCalcDate,"</span>\n                </p>\n            </div>\n            "),loadSensors()}).catch(function(e){return console.log(e)})},loadStacions=function(){var e=new FormData;e.append("url","http://api.gios.gov.pl/pjp-api/rest/station/findAll"),fetch("inc/ajax.php",{method:"POST",body:e}).then(function(e){return e.text()}).then(function(e){stations=JSON.parse(e),createSelect(stations),loadSelectValue(),loadQuality()}).catch(function(e){return console.log(e)})};loadStacions(),select.addEventListener("change",function(){localStorage.setItem("station",select.value),htmlText="",counter=0,loadQuality()});var icon=document.querySelector(".search__icon");select.addEventListener("focusout",function(){icon.classList.remove("active")}),select.addEventListener("click",function(){icon.classList.toggle("active")}),select.addEventListener("touch",function(){icon.classList.toggle("active")});