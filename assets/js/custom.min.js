"use strict";var loadQuality=function(){dataWrapper.innerHTML='\n    <div class="loader">\n        <img class="loader__cloud-1" src="assets/images/Loader1.svg">\n        <img class="loader__cloud-2" src="assets/images/Loader2.svg">\n    </div>';var e=new FormData;e.append("url","http://api.gios.gov.pl/pjp-api/rest/aqindex/getIndex/"+select.value),fetch("inc/ajax.php",{method:"POST",body:e}).then(function(e){return e.text()}).then(function(e){var t="";switch((quality=JSON.parse(e)).stIndexLevel.indexLevelName){case"Bardzo dobry":case"Dobry":t="font-good";break;case"Umiarkowany":case"Dostateczny":t="font-neutral";break;case"Zły":case"Bardzo zły":t="font-bad"}htmlText+='\n            <div class="data__wrapper">\n                <div class="box box--left">\n                    <p>\n                        <span>Indeks jakości powietrza:</span>\n                        <span class="quality '.concat(t,'">').concat(quality.stIndexLevel.indexLevelName,'</span>\n                    </p>\n                    <div class="image"></div>\n                    <p>\n                        <span>Data pomiaru:</span>\n                        <span class="date">').concat(quality.stCalcDate,"</span>\n                    </p>\n                </div>\n            "),loadSensors()}).catch(function(e){return console.log(e)})},decimal=function(e,t){var a=Math.pow(10,t+1);return(e=Math.round(Math.round(e*a)/10))/(a/10)},loadSensorData=function(e,l){var t=new FormData;t.append("url","http://api.gios.gov.pl/pjp-api/rest/data/getData/"+e),fetch("inc/ajax.php",{method:"POST",body:t}).then(function(e){return e.text()}).then(function(e){for(var t,a=JSON.parse(e),s="brak danych",n=0;n<a.values.length;n++)if(null!=a.values[n].value){s=a.values[n].value;break}var o="µg/m3";switch(sensors[l].param.idParam){case 1:t=350;break;case 3:t=50;break;case 5:t=120;break;case 6:t=200;break;case 8:t=1e4,o="mg/m3";break;case 10:t=5;break;case 69:t=25}var c=Math.round(s/t*100),r="";r=c<40?"bg-good":c<100?"bg-neutral":"bg-bad","brak danych"!=s&&(htmlText+='\n            <div class="sensor">\n                <p>\n                    <span class="sensor__label" data-id="'.concat(sensors[l].param.idParam,'">').concat(sensors[l].param.paramName,": </span>\n                    <span>").concat(decimal(s,5)," ").concat(o,'</span>\n                </p>\n                <div class="sensor__row">\n                    <div class="sensor__bar">\n                        <div class="sensor__indicator ').concat(r,'" style="width: ').concat(c,'%"></div>\n                    </div>\n\n                    <span class="sensor__percent ').concat(r,'" >').concat(c,"%</span>\n                </div>\n            </div>\n            ")),++counter==sensors.length&&(htmlText+="\n                    </div>\n                </div>\n                ",dataWrapper.innerHTML=htmlText,switchImage())}).catch(function(e){return console.log(e)})},loadSensors=function(){var e=new FormData;e.append("url","http://api.gios.gov.pl/pjp-api/rest/station/sensors/"+select.value),fetch("inc/ajax.php",{method:"POST",body:e}).then(function(e){return e.text()}).then(function(e){sensors=JSON.parse(e),htmlText+='<div class="box box--right">',sensors.forEach(function(e,t){loadSensorData(e.id,t)})}).catch(function(e){return console.log(e)})},loadStacions=function(){var e=new FormData;e.append("url","http://api.gios.gov.pl/pjp-api/rest/station/findAll"),fetch("inc/ajax.php",{method:"POST",body:e}).then(function(e){return e.text()}).then(function(e){stations=JSON.parse(e),createSelect(stations),loadSelectValue(),loadQuality()}).catch(function(e){return console.log(e)})},select=document.querySelector(".search__select"),icon=document.querySelector(".search__icon");select.addEventListener("focusout",function(){icon.classList.remove("active")}),select.addEventListener("click",function(){icon.classList.toggle("active")}),select.addEventListener("touch",function(){icon.classList.toggle("active")});var switchImage=function(){var e=document.querySelector(".image"),t=quality.stIndexLevel.indexLevelName,a="";"theme-dark"===localStorage.getItem("theme")&&(a="_Noc"),e.innerHTML="Bardzo dobry"==t||"Dobry"==t?'\n            <img class="image__bg" src="assets/images/Bardzo-dobry_Tlo'.concat(a,'.svg"> \n            <img class="image__cloud" src="assets/images/Bardzo-dobry_Chmurka').concat(a,'.svg"> \n            <img class="image__addition" src="assets/images/Bardzo-dobry_Dodatek').concat(a,'.svg"> \n            '):"Umiarkowany"==t||"Dostateczny"==t?'\n            <img class="image__bg" src="assets/images/Umiarkowany_Tlo'.concat(a,'.svg"> \n            <img class="image__cloud" src="assets/images/Umiarkowany_Chmurka').concat(a,'.svg"> \n            '):"Zły"==t||"Bardzo zły"==t?'\n            <img class="image__bg" src="assets/images/Zly_Tlo'.concat(a,'.svg"> \n            <img class="image__cloud" src="assets/images/Zly_Chmurka').concat(a,'.svg"> \n            '):'\n            <img class="image__bg" src="assets/images/Brak-danych_Tlo'.concat(a,'.svg"> \n            <img class="image__cloud" src="assets/images/Brak-danych-Chmurka').concat(a,'.svg"> \n            ')},themeBtn=document.querySelector(".theme-switch"),setTheme=function(e){localStorage.setItem("theme",e);var t=document.documentElement;"theme-light"==e?(t.style.setProperty("--color-bg","#F5F9FF"),t.style.setProperty("--color-blur-light","#FFFFFF"),t.style.setProperty("--color-font","#576A8A"),t.style.setProperty("--color-blur-dark","#D6E0F0"),t.style.setProperty("--color-deep","transparent linear-gradient(180deg, #D6E0F0 0%, #D6E0F0 1%, #FFFFFF 100%) 0% 0% no-repeat padding-box")):(t.style.setProperty("--color-bg","#2B2F35"),t.style.setProperty("--color-blur-light","#3B3E42"),t.style.setProperty("--color-font","#F5F9FF"),t.style.setProperty("--color-blur-dark","#181C22"),t.style.setProperty("--color-deep","transparent linear-gradient(360deg, #21262e 0%, #10131858 53%, #202020 100%) 0% 0% no-repeat padding-box"))},toggleTheme=function(){"theme-dark"===localStorage.getItem("theme")?(setTheme("theme-light"),themeBtn.classList.remove("active")):(setTheme("theme-dark"),themeBtn.classList.add("active")),switchImage()};"theme-dark"===localStorage.getItem("theme")?(setTheme("theme-dark"),themeBtn.classList.add("active")):(setTheme("theme-light"),themeBtn.classList.remove("active")),themeBtn.addEventListener("click",toggleTheme),themeBtn.addEventListener("touch",toggleTheme);select=document.querySelector(".search__select");var stations,sensors,quality,stationName=document.querySelector(".data__name"),htmlText="",dataWrapper=document.querySelector(".data"),counter=0,createSelect=function(e){e.sort(function(e,t){return e.city.name.localeCompare(t.city.name)}),e.forEach(function(e){var t=document.createElement("option");t.text=e.city.name,null!=e.addressStreet&&(t.text+=" "+e.addressStreet),t.value=e.id,select.add(t)})},generateSearch=function(e){var t="?station=".concat(e);history.pushState(!1,"",t)},loadSelectValue=function(){var e=new URLSearchParams(window.location.search).get("station");e?select.value=e:null!=localStorage.getItem("station")?select.value=localStorage.getItem("station"):select.value=117,generateSearch(select.value),localStorage.setItem("station",select.value)};loadStacions(),select.addEventListener("change",function(){localStorage.setItem("station",select.value),htmlText="",counter=0,generateSearch(select.value),loadQuality()});